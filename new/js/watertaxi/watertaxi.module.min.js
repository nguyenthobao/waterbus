$(document).ready(function(){var u,r=$("#bookingWaterTaxi #startPoint"),d=$("#bookingWaterTaxi #endPoint"),m=1,v=0,s=$("#bookingWaterTaxi #depatureDateTaxi"),g=$("#bookingWaterTaxi #vehicleType");function p(t){var e=t.split(" "),a="";for(i=3;i<e.length;i++)a+=e[i]+" ";return a}s.datepicker({dateFormat:"dd/mm/yy",minDate:0}).datepicker("setDate",new Date),$("#bookingWaterTaxi #numberTicket").val(m+" vé"),$("#bookingWaterTaxi #upTicket").click(function(){m++,$("#bookingWaterTaxi #numberTicket").val(m+" vé")}),$("#bookingWaterTaxi #downTicket").click(function(){1<m&&m--,$("#bookingWaterTaxi #numberTicket").val(m+" vé")}),r.change(function(){var t=$(this).val();$("#bookingWaterTaxi #endPoint option").show(),$("#bookingWaterTaxi #endPoint option[value="+t+"]").hide();var e=$("#bookingWaterTaxi #startPoint").prop("selectedIndex");$("#bookingWaterTaxi #endPoint").prop("selectedIndex",e),lat=$(this).find(":selected").data("lat"),long=$(this).find(":selected").data("long"),pointName=$(this).find(":selected").text(),initStartMarker(lat,long,pointName);var i=$("#bookingWaterTaxi #endPoint").find(":selected");pointNameEnd=i.text(),latEnd=i.data("lat"),longEnd=i.data("long"),initEndMarker(latEnd,longEnd,pointNameEnd)}),$("#seachWaterTaxi").click(function(){return $.alert({title:"Thông báo",type:"green",typeAnimated:!0,content:"Bạn đang sử dụng dịch vụ Saigon Watertaxi. Phí mở cửa là 270.000 VNĐ/lượt cho nhóm tối đa 6 người. Từ người tiếp theo, giá vé là 60.000 VNĐ/người/lượt",buttons:{ok:{text:"Đồng ý"}},onClose:function(){var t,e,i,a,n,o,l,c;t=r,e=d,i=g,a=s.val().split("/"),n=a[0]+"-"+a[1]+"-"+a[2],o=p(t.find(":selected").text()),l=p(e.find(":selected").text()),c=o+" - "+l,$(".route-name").text(c),$("#bookingWaterTaxi .booing-form").hide(300),$("#bookingWaterTaxi .list-schedule").show(300),$(".schedule-list").html('<div class="loading"></div>'),$.ajax({type:"POST",url:"https://anvui.vn/listSchedule2",data:{startPoint:t.val(),endPoint:e.val(),date:n,companyId:systemId,vehicleTypeId:i.val(),page:0,count:1e3},success:function(t){var e,i;e=t,i="",$.each(e,function(t,e){i+='<div class="col-12 margin-schedule">',i+='<div class="row schedule-item" data-ticketprice="'+e.ticketPrice+'" data-openprice="'+e.openPrice+'" data-getinpoint="'+e.getInPointId+'" data-getoffpoint="'+e.getOffPointId+'" data-getintime="'+e.getInTime+'" data-getofftime="'+e.getOffTime+'" data-startdate="'+e.startDate+'" data-scheduleid="'+e.scheduleId+'" data-tripid="'+e.tripId+'" data-tripstatus="'+e.tripStatus+'" data-numberticket="'+e.totalEmptySeat+'" data-maxguestopen="'+e.maxGuestForOpenPrice+'" data-totalseat="'+e.totalSeat+'" data-starttime="'+e.startTimeUnix+'">',i+='<div class="col-8">',i+='<div class="schedule-date">'+getFormattedDate(e.startDate,"dM")+"</div>",e.startTimeUnix<Date.now()||2===e.tripStatus?i+='<div class="schedule-status">Đã khởi hành</div>':i+='<div class="totalEmptySeat">Còn trống '+e.totalEmptySeat+" vé</div>",i+="</div>",i+='<div class="col-4">',i+='<div class="schedule-time pull-right">'+getFormattedDate(e.startTimeUnix,"time")+"</div>",i+="</div>",i+="</div>",i+="</div>"}),$(".schedule-list").html(i)}})}}),!1}),$(".list-schedule .backScreen").click(function(){return $("#bookingWaterTaxi .list-schedule").hide(300),$("#bookingWaterTaxi .booing-form").show(300),!1}),$("body").on("click","#bookingWaterTaxi .schedule-item",function(){var t=$(this).data("getinpoint"),e=$(this).data("getoffpoint"),i=$(this).data("getintime"),a=$(this).data("getofftime"),n=$(this).data("starttime"),o=$(this).data("tripstatus"),l=$(this).data("scheduleid"),c=$(this).data("ticketprice"),r=$(this).data("openprice"),d=$(this).data("tripid"),s=$(this).data("numberticket"),g=$(this).data("totalseat"),p=$(this).data("startdate"),h=$(this).data("maxguestopen");if(n<Date.now()||2===o)$.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Vé đã bán hết, vui lòng chọn chuyến khác hoặc chọn một ngày khởi hành khác"});else if(s<m)$.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Số vé bán đặt nhiều hơn số vé hiện có"});else{$("#bookingWaterTaxi .schedule-item").removeClass("selected-schedule"),$(this).addClass("selected-schedule");var u=function(t,e,i,a,n,o,l,c,r,d,s,g,p){var h="";if(h='<div id="ticketOnewayInfo">',d!==s)for(var u=0;u<t;u++)h+='<div class="col-12 margin-ticket">',h+='<div class="row ticket-info-item">',h+='<div class="col-12 row no-padding-left no-margin-left-right margin-top10 margin-bottom10">',h+='<label class="col-4">Họ tên:</label>',h+='<div class="col-8 no-padding-right">',h+='<input type="text" class="form-control fullname">',h+="</div>",h+="</div>",h+='<div class="col-12 row no-padding-left no-margin-left-right margin-top10 margin-bottom10">',h+='<label class="col-4">Số điện thoại:</label>',h+='<div class="col-8 no-padding-right">',h+='<input type="text" class="form-control phoneNumber">',h+="</div>",h+="</div>",h+='<div class="col-12 col-centered margin-top10 margin-bottom10">',h+='<input type="text" value="'+e.format()+' VNĐ" readonly class="form-control text-center ticketPrice">',h+="</div>",h+='<input type="hidden" class="price" value="'+e+'">',h+="</div>",h+="</div>";else{var m=p;t<=p&&(m=t);for(var v=g/m,u=0;u<t;u++)h+='<div class="col-12 margin-ticket">',h+='<div class="row ticket-info-item">',h+='<div class="col-12 row no-padding-left no-margin-left-right margin-top10 margin-bottom10">',h+='<label class="col-4">Họ tên:</label>',h+='<div class="col-8 no-padding-right">',h+='<input type="text" class="form-control fullname">',h+="</div>",h+="</div>",h+='<div class="col-12 row no-padding-left no-margin-left-right margin-top10 margin-bottom10">',h+='<label class="col-4">Số điện thoại:</label>',h+='<div class="col-8 no-padding-right">',h+='<input type="text" class="form-control phoneNumber">',h+="</div>",h+="</div>",u<m?(h+='<div class="col-12 col-centered margin-top10 margin-bottom10">',h+='<input type="text" value="VÉ TRONG NHÓM VÉ MỞ CỬA" readonly class="form-control text-center ticketPrice">',h+="</div>",h+='<input type="hidden" class="price" value="'+v+'">'):(h+='<div class="col-12 col-centered margin-top10 margin-bottom10">',h+='<input type="text" value="'+e.format()+' VNĐ" readonly class="form-control text-center ticketPrice">',h+="</div>",h+='<input type="hidden" class="price" value="'+e+'">'),h+="</div>",h+="</div>"}return h+='<div class="col-12 margin-ticket">',h+='<div class="row customer-info">',h+='<div class="col-12 row no-margin-left-right margin-top10">',h+="<label>Số lượng vé</label>",h+='<input type="text" value="'+t+'" class="col-12 form-control text-center" readonly>',h+="</div>",h+='<div class="col-12 row no-margin-left-right margin-top10">',h+="<label>Ghi chú</label>",h+='<input type="text" class="col-12 form-control" placeholder="Ghi chú" id="note">',h+="</div>",h+='<div class="col-12 row no-margin-left-right margin-top10 margin-bottom10">',h+="<label>Email nhận thông tin vé</label>",h+='<input type="email" placeholder="Email nhận thông tin vé" class="col-12 form-control" id="email">',h+="</div>",h+='<input type="hidden" value="'+i+'" id="tripId">',h+='<input type="hidden" value="'+a+'" id="scheduleId">',h+='<input type="hidden" value="'+n+'" id="getInPointId">',h+='<input type="hidden" value="'+o+'" id="getOffPointId">',h+='<input type="hidden" value="'+l+'" id="getInTimePlan">',h+='<input type="hidden" value="'+c+'" id="getOffTimePlan">',h+='<input type="hidden" value="'+r+'" id="startDate">',h+="</div>",h+="</div>",h+="</div>"}(m,c,d,l,t,e,i,a,p,s,g,r,h);$("#bookingWaterTaxi .ticket-info-list").html(u)}$(".phoneNumber").on("keypress keyup blur",function(){$(this).val($(this).val().replace(/[^\d].+/,"")),(event.which<48||57<event.which)&&event.preventDefault()})}),$("#bookingWaterTaxi .btnNext").click(function(){if(!$(".schedule-list .selected-schedule").length)return $.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Chưa chọn chuyến đi"}),!1;u=$("#bookingWaterTaxi .ticket-info-list .price").map(function(){return $(this).val()}).get(),totalMoneyTicket=0,$.each(u,function(t,e){totalMoneyTicket+=parseInt(e)}),v=totalMoneyTicket-0,$("#bookingWaterTaxi .total-money").val(v.format()+" VNĐ"),$("#bookingWaterTaxi .list-schedule").hide(300),$("#bookingWaterTaxi .ticket-info").show(300)}),$(".ticket-info .backScreen").click(function(){return $("#bookingWaterTaxi .ticket-info").hide(300),$("#bookingWaterTaxi .list-schedule").show(300),!1}),$("#bookingWaterTaxi .payment").click(function(){var t=$("#bookingWaterTaxi #ticketOnewayInfo .fullname").map(function(){return $(this).val()}).get(),e=$("#bookingWaterTaxi #ticketOnewayInfo .phoneNumber").map(function(){return $(this).val()}).get(),i=$("#bookingWaterTaxi #ticketOnewayInfo #scheduleId").val(),a=$("#bookingWaterTaxi #ticketOnewayInfo #tripId").val(),n=$("#bookingWaterTaxi #ticketOnewayInfo #getInPointId").val(),o=$("#bookingWaterTaxi #ticketOnewayInfo #getOffPointId").val(),l=$("#bookingWaterTaxi #ticketOnewayInfo #getInTimePlan").val(),c=$("#bookingWaterTaxi #ticketOnewayInfo #getOffTimePlan").val(),r=$("#bookingWaterTaxi #ticketOnewayInfo #note").val(),d=$("#bookingWaterTaxi #ticketOnewayInfo #startDate").val();if(""===t[0])return $.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Chưa nhập họ tên chuyến đi"}),!1;if(""===e[0])return $.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Chưa nhập số điện thoại chuyến đi"}),!1;for(var s,g="[",p={},h=0;h<m;h++)p.paymentTicketPrice=u[h],p.phoneNumber=e[h],p.originalPrice=u[h],p.seatId="",p.priceInsurance=0,p.extraPrice=0,p.ticketPrice=u[h],p.isAdult=!0,p.fullName=t[h],p.surcharge=0,p.priceMeal=-1,p.agencyPrice=u[h],p.totalPrice=u[h],g+=h===m-1?JSON.stringify(p):JSON.stringify(p)+",";g+="]",dataListOption={startDate:d,scheduleId:i,paymentTicketPrice:v,packageName:"web",tripId:a,timeZone:"7",originalTicketPrice:v,numberOfAdults:m,getOffPointId:o,phoneNumber:e[0],numberOfChildren:"0",description:r,getOffTimePlan:c,listOption:JSON.parse(g),getInTimePlan:l,fullName:t[0],paidMoney:"0",companyId:systemId,getInPointId:n,agencyPrice:v},s=dataListOption,$.ajax({type:"POST",url:"https://anvui.vn/createnoseatid",data:s,success:function(t){var e,i;200===t.code?($.dialog({title:"Thông báo!",content:"Hệ thống đang chuyển sang cổng thanh toán, vui lòng đợi trong giây lát...",onClose:function(t){t.preventDefault()}}),e=t.results.ticketId,i=s.phoneNumber,$.ajax({type:"POST",url:"https://dobody-anvui.appspot.com/ePay/",dataType:"json",data:JSON.stringify({ticketId:e,paymentType:1,packageName:"web",phoneNumber:i}),success:function(t){url=t.results.redirect,setTimeout(function(){window.location.href=url},4e3)}})):$.alert({title:"Thông báo!",type:"red",typeAnimated:!0,content:"Đã có lỗi xảy ra, vui lòng thử lại"})}})})});