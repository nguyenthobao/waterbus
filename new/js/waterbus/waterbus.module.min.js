$(document).ready(function(){var P,O,T=!1,w=1,d=$("#bookingWaterBus #startPoint"),h=$("#bookingWaterBus #endPoint"),t=$("#bookingWaterBus #depatureDate"),g=$("#bookingWaterBus #returnDate"),k=$("#bookingWaterBus #vehicleType"),p="",n=0,N=0,C=0;function f(t,e,n,i,a,o){var r=i.val().split("/"),s=r[0]+"-"+r[1]+"-"+r[2],c=l(t.find(":selected").text())+" - "+l(e.find(":selected").text());a||$(".route-name").text(c),$("#bookingWaterBus .booing-form").hide(300),$("#bookingWaterBus .list-schedule").show(300),a?$(".schedule-list-return").html('<div class="loading"></div>'):$(".schedule-list").html('<div class="loading"></div>'),$.ajax({type:"POST",url:"https://anvui.vn/listSchedule2",data:{startPoint:t.val(),endPoint:e.val(),date:s,companyId:systemId,vehicleTypeId:n.val(),page:0,count:1e3},success:function(t){a?buildSchedulListReturn(t,o):buildSchedulListOneWay(t)}})}function l(t){var e=t.split(" "),n="";for(i=3;i<e.length;i++)n+=e[i]+" ";return n}function D(o,r,s){void 0!==o&&""!==o&&$.ajax({type:"POST",url:"https://anvui.vn/createnoseatid",data:o,success:function(t){if(200===t.code)if(void 0!==r&&""!==r){var e=t.results.ticketId;D(r,"",e)}else{var n=t.results.ticketId;void 0!==s&&""!==s&&(n=s+"-"+t.results.ticketId),$.dialog({title:"Thông báo!",content:"Hệ thống đang chuyển sang cổng thanh toán, vui lòng đợi trong giây lát...",onClose:function(t){t.preventDefault()}}),i=n,a=o.phoneNumber,$.ajax({type:"POST",url:"https://dobody-anvui.appspot.com/ePay/",dataType:"json",data:JSON.stringify({ticketId:i,paymentType:1,packageName:"web",phoneNumber:a}),success:function(t){url=t.results.redirect,setTimeout(function(){window.location.href=url},4e3)}})}else $.alert({title:"Thông báo!",type:"red",typeAnimated:!0,content:"Đã có lỗi xảy ra, vui lòng thử lại"});var i,a}})}$("#bookingWaterBus #numberTicket").val(w+" vé"),$("#bookingWaterBus #isRound").change(function(){$(this).is(":checked")?(T=!0,$("#bookingWaterBus #divStartPoint").removeClass("col-12"),$("#bookingWaterBus #divStartPoint").addClass("col-6"),$("#bookingWaterBus #divEndPoint").show()):(T=!1,$("#bookingWaterBus #divEndPoint").hide(),$("#bookingWaterBus #divStartPoint").removeClass("col-6"),$("#bookingWaterBus #divStartPoint").addClass("col-12"))}),$("#bookingWaterBus #depatureDate").datepicker({dateFormat:"dd/mm/yy",minDate:0,onSelect:function(t){changeDate(t,"#bookingWaterBus #returnDate")}}).datepicker("setDate",new Date),$("#bookingWaterBus #returnDate").datepicker({dateFormat:"dd/mm/yy",minDate:0}).datepicker("setDate",new Date),$.ajax({type:"POST",url:"https://dobody-anvui.appspot.com/point/get_province_and_point",dataType:"json",data:JSON.stringify({companyId:systemId}),success:function(t){listDistrict=t.results.result[0].listDistrict,$.each(listDistrict,function(t,e){d.append("<option data-lat='"+e.latitude+"' data-long='"+e.longitude+"' value='"+e.districtId+"'>"+e.districtName+"</option>")}),$.each(listDistrict.reverse(),function(t,e){h.append("<option data-lat='"+e.latitude+"' data-long='"+e.longitude+"' value='"+e.districtId+"'>"+e.districtName+"</option>")})}}),$("#bookingWaterBus #upTicket").click(function(){w<=10&&w++,$("#bookingWaterBus #numberTicket").val(w+" vé")}),$("#bookingWaterBus  #downTicket").click(function(){1<w&&w--,$("#bookingWaterBus #numberTicket").val(w+" vé")}),d.change(function(){var t=$(this).val();$("#bookingWaterBus #endPoint option").show(),$("#bookingWaterBus #endPoint option[value="+t+"]").hide(),lat=$(this).find(":selected").data("lat"),long=$(this).find(":selected").data("long"),pointName=$(this).find(":selected").text(),initStartMarker(lat,long,pointName)}),h.change(function(){var t=$(this).val();$("#bookingWaterBus #startPoint option").show(),$("#bookingWaterBus #startPoint option[value="+t+"]").hide(),lat=$(this).find(":selected").data("lat"),long=$(this).find(":selected").data("long"),pointName=$(this).find(":selected").text(),initEndMarker(lat,long,pointName)}),$("#seachWaterbus").click(function(){return null===d.val()?($.alert({title:"Cảnh báo!",type:"red",typeAnimated:!0,content:"Chưa chọn bến đi"}),!1):null===h.val()?($.alert({title:"Cảnh báo!",type:"red",typeAnimated:!0,content:"Chưa chọn bến đến"}),!1):""===t.val()?($.alert({title:"Cảnh báo!",type:"red",typeAnimated:!0,content:"Chưa chọn ngày đi"}),!1):(f(d,h,k,t,!1),void(T?($("#bookingWaterBus .schedule-list").removeClass("col-12"),$("#bookingWaterBus .schedule-list").addClass("col-6"),$("#bookingWaterBus .schedule-list-return").show(),$(".title-round").show(),f(h,d,k,g,!0)):($("#bookingWaterBus .schedule-list-return").hide(),$("#bookingWaterBus .schedule-list").removeClass("col-6"),$("#bookingWaterBus .schedule-list").addClass("col-12"),$(".title-round").hide())))}),$("body").on("click","#bookingWaterBus .schedule-item",function(){var t=$(this).data("getinpoint"),e=$(this).data("getoffpoint"),n=$(this).data("getintime"),i=$(this).data("getofftime"),a=$(this).data("starttime"),o=$(this).data("tripstatus"),r=$(this).data("scheduleid"),s=$(this).data("ticketprice"),c=$(this).data("tripid"),l=$(this).data("numberticket"),u=$(this).data("startdate");a<Date.now()||2===o?$.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Vé đã bán hết, vui lòng chọn chuyến khác hoặc chọn một ngày khởi hành khác"}):l<w?$.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Số vé bán đặt nhiều hơn số vé hiện có"}):($("#bookingWaterBus .schedule-item").removeClass("selected-schedule"),$(this).addClass("selected-schedule"),p="",p=buildTicket(w,s,c,r,t,e,n,i,u,!1,!0),$("#bookingWaterBus .ticket-info-list").html(p),T&&f(h,d,k,g,!0,a)),$(".phoneNumber").on("keypress keyup blur",function(){$(this).val($(this).val().replace(/[^\d].+/,"")),(event.which<48||57<event.which)&&event.preventDefault()})}),$("body").on("click","#bookingWaterBus .schedule-item-return",function(){var t=$(this).data("getinpoint"),e=$(this).data("getoffpoint"),n=$(this).data("getintime"),i=$(this).data("getofftime"),a=$(this).data("starttime"),o=$(this).data("tripstatus"),r=$(this).data("scheduleid"),s=$(this).data("ticketprice"),c=$(this).data("tripid"),l=$(this).data("numberticket"),u=$(this).data("startdate");if(a<Date.now()||2===o)$.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Vé đã bán hết, vui lòng chọn chuyến khác hoặc chọn một ngày khởi hành khác"});else if(l<w)$.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Số vé bán đặt nhiều hơn số vé hiện có"});else{$("#bookingWaterBus .schedule-item-return").removeClass("selected-schedule"),$(this).addClass("selected-schedule");var d=buildTicket(w,s,c,r,t,e,n,i,u,!0,!0);p+=d,$("#bookingWaterBus .ticket-info-list").html(p)}$(".phoneNumber").on("keypress keyup blur",function(){$(this).val($(this).val().replace(/[^\d].+/,"")),(event.which<48||57<event.which)&&event.preventDefault()}),$("#bookingWaterBus #ticketOnewayInfo .fullname:first").focusout(function(){$("#bookingWaterBus #ticketReturnInfo .fullname:first").val($(this).val())}),$("#bookingWaterBus #ticketOnewayInfo .phoneNumber:first").focusout(function(){$("#bookingWaterBus #ticketReturnInfo .phoneNumber:first").val($(this).val())})}),$(".booing-form .backScreen").click(function(){return $(".booking").hide(300),$("#selectOption").show(),!1}),$(".list-schedule .backScreen").click(function(){return $("#bookingWaterBus .list-schedule").hide(300),$("#bookingWaterBus .booing-form").show(300),!1}),$(".ticket-info .backScreen").click(function(){return $("#bookingWaterBus .ticket-info").hide(300),$("#bookingWaterBus .list-schedule").show(300),!1}),$("#bookingWaterBus .btnNext").click(function(){var t=$(".schedule-list .selected-schedule").length,e=$(".schedule-list-return .selected-schedule").length;return t?T&&!e?($.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Chưa chọn chuyến về"}),!1):(P=$("#bookingWaterBus #ticketOnewayInfo .price").map(function(){return $(this).val()}).get(),O=$("#bookingWaterBus #ticketReturnInfo .price").map(function(){return $(this).val()}).get(),N=0,$.each(P,function(t,e){N+=parseInt(e)}),C=0,$.each(O,function(t,e){C+=parseInt(e)}),n=N-0+(C-0),$("#bookingWaterBus .total-money").val(n.format()+" VNĐ"),$("#bookingWaterBus .list-schedule").hide(300),void $("#bookingWaterBus .ticket-info").show(300)):($.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Chưa chọn chuyến đi"}),!1)}),$("#bookingWaterBus .payment").click(function(){var t=$("#bookingWaterBus #ticketOnewayInfo .fullname").map(function(){return $(this).val()}).get(),e=$("#bookingWaterBus #ticketOnewayInfo .phoneNumber").map(function(){return $(this).val()}).get(),n=$("#bookingWaterBus #ticketReturnInfo .fullname").map(function(){return $(this).val()}).get(),i=$("#bookingWaterBus #ticketReturnInfo .phoneNumber").map(function(){return $(this).val()}).get(),a=$("#bookingWaterBus #ticketOnewayInfo #scheduleId").val(),o=$("#bookingWaterBus #ticketOnewayInfo #tripId").val(),r=$("#bookingWaterBus #ticketOnewayInfo #getInPointId").val(),s=$("#bookingWaterBus #ticketOnewayInfo #getOffPointId").val(),c=$("#bookingWaterBus #ticketOnewayInfo #getInTimePlan").val(),l=$("#bookingWaterBus #ticketOnewayInfo #getOffTimePlan").val(),u=$("#bookingWaterBus #ticketOnewayInfo #note").val(),d=$("#bookingWaterBus #ticketOnewayInfo #startDate").val(),h=$("#bookingWaterBus #ticketReturnInfo #scheduleId").val(),g=$("#bookingWaterBus #ticketReturnInfo #tripId").val(),k=$("#bookingWaterBus #ticketReturnInfo #getInPointId").val(),p=$("#bookingWaterBus #ticketReturnInfo #getOffPointId").val(),f=$("#bookingWaterBus #ticketReturnInfo #getInTimePlan").val(),b=$("#bookingWaterBus #ticketReturnInfo #getOffTimePlan").val(),m=$("#bookingWaterBus #ticketReturnInfo #note").val(),y=$("#bookingWaterBus #ticketReturnInfo #startDate").val();if(""===t[0])return $.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Chưa nhập họ tên chuyến đi"}),!1;if(""===e[0])return $.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Chưa nhập số điện thoại chuyến đi"}),!1;for(var v="[",I={},W=0;W<w;W++)I.paymentTicketPrice=P[W],I.phoneNumber=e[W],I.originalPrice=P[W],I.seatId="",I.priceInsurance=0,I.extraPrice=0,I.ticketPrice=P[W],I.isAdult=!0,I.fullName=t[W],I.surcharge=0,I.priceMeal=-1,I.agencyPrice=P[W],I.totalPrice=P[W],v+=W===w-1?JSON.stringify(I):JSON.stringify(I)+",";if(v+="]",T){var B=generatePaymentCode();if(dataOneway={startDate:d,scheduleId:a,paymentTicketPrice:N,packageName:"web",tripId:o,timeZone:"7",originalTicketPrice:N,numberOfAdults:w,getOffPointId:s,phoneNumber:e[0],numberOfChildren:"0",description:u,getOffTimePlan:l,listOption:JSON.parse(v),getInTimePlan:c,fullName:t[0],paidMoney:"0",companyId:systemId,getInPointId:r,agencyPrice:N,paymentCode:B},""===n[0])return $.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Chưa nhập họ tên chuyến về"}),!1;if(""===i[0])return $.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Chưa nhập số điện thoại chuyến về"}),!1;v="[",I={};for(W=0;W<w;W++)I.paymentTicketPrice=O[W],I.phoneNumber=i[W],I.originalPrice=O[W],I.seatId="",I.priceInsurance=0,I.extraPrice=0,I.ticketPrice=O[W],I.isAdult=!0,I.fullName=n[W],I.surcharge=0,I.priceMeal=-1,I.agencyPrice=O[W],I.totalPrice=O[W],v+=W===w-1?JSON.stringify(I):JSON.stringify(I)+",";v+="]",dataReturn={startDate:y,scheduleId:h,paymentTicketPrice:C,packageName:"web",tripId:g,timeZone:"7",originalTicketPrice:C,numberOfAdults:w,getOffPointId:p,phoneNumber:i[0],numberOfChildren:"0",description:m,getOffTimePlan:b,listOption:JSON.parse(v),getInTimePlan:f,fullName:n[0],paidMoney:"0",companyId:systemId,getInPointId:k,agencyPrice:C,paymentCode:B},D(dataOneway,dataReturn)}else dataOneway={startDate:d,scheduleId:a,paymentTicketPrice:N,packageName:"web",tripId:o,timeZone:"7",originalTicketPrice:N,numberOfAdults:w,getOffPointId:s,phoneNumber:e[0],numberOfChildren:"0",description:u,getOffTimePlan:l,listOption:JSON.parse(v),getInTimePlan:c,fullName:t[0],paidMoney:"0",companyId:systemId,getInPointId:r,agencyPrice:N},D(dataOneway)})}),$("body").on("click","#bookingWaterBus .ticket-free",function(){$.alert({title:"Thông báo",content:"Dành cho người già từ 70 tuổi và trẻ em dưới 1m. Vé miễn phí chỉ áp dụng khi giao dịch tại các ga tàu thủy",buttons:{ok:{text:"Đồng ý"}}})});