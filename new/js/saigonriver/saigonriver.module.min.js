$(document).ready(function(){var v,p=1,y=0,n=$("#booingSaigonRiver #depatureDateRiver"),o=$("#booingSaigonRiver #vehicleType");n.datepicker({dateFormat:"dd/mm/yy",minDate:0}).datepicker("setDate",new Date),$("#booingSaigonRiver #numberTicket").val(p+" vé"),$("#booingSaigonRiver #upTicket").click(function(){p++,$("#booingSaigonRiver #numberTicket").val(p+" vé")}),$("#booingSaigonRiver  #downTicket").click(function(){1<p&&p--,$("#booingSaigonRiver #numberTicket").val(p+" vé")}),$("#seachSaigonRiver").click(function(){if(""===n.val())return $.alert({title:"Cảnh báo!",type:"red",typeAnimated:!0,content:"Chưa chọn ngày đi"}),!1;var e,t,i;e=o,t=n.val().split("/"),i=t[0]+"-"+t[1]+"-"+t[2],$(".schedule-list").html('<div class="loading"></div>'),$("#booingSaigonRiver .booing-form").hide(300),$("#booingSaigonRiver .list-schedule").show(300),$.ajax({type:"POST",url:"https://anvui.vn/listSchedule2",data:{startPoint:"P03k1Iq7vRvdDS",endPoint:"P03k1IqIku8fXQ",date:i,companyId:systemId,vehicleTypeId:e.val(),page:0,count:1e3},success:function(e){buildSchedulListOneWay(e)}})}),$(".list-schedule .backScreen").click(function(){return $("#booingSaigonRiver .list-schedule").hide(300),$("#booingSaigonRiver .booing-form").show(300),!1}),$(".ticket-info .backScreen").click(function(){return $("#booingSaigonRiver .ticket-info").hide(300),$("#booingSaigonRiver .list-schedule").show(300),!1}),$("#booingSaigonRiver .btnNext").click(function(){if(!$(".schedule-list .selected-schedule").length)return $.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Chưa chọn chuyến đi"}),!1;v=$("#booingSaigonRiver #ticketOnewayInfo .price").map(function(){return $(this).val()}).get(),totalMoneyTicket=0,$.each(v,function(e,t){totalMoneyTicket+=parseInt(t)}),y=totalMoneyTicket-0,$("#booingSaigonRiver .total-money").val(y.format()+" VNĐ"),$("#booingSaigonRiver .list-schedule").hide(300),$("#booingSaigonRiver .ticket-info").show(300)}),$("#booingSaigonRiver .payment").click(function(){var e=$("#booingSaigonRiver #ticketOnewayInfo .fullname").map(function(){return $(this).val()}).get(),t=$("#booingSaigonRiver #ticketOnewayInfo .phoneNumber").map(function(){return $(this).val()}).get(),i=$("#booingSaigonRiver #ticketOnewayInfo #scheduleId").val(),n=$("#booingSaigonRiver #ticketOnewayInfo #tripId").val(),o=$("#booingSaigonRiver #ticketOnewayInfo #getInPointId").val(),a=$("#booingSaigonRiver #ticketOnewayInfo #getOffPointId").val(),c=$("#booingSaigonRiver #ticketOnewayInfo #getInTimePlan").val(),r=$("#booingSaigonRiver #ticketOnewayInfo #getOffTimePlan").val(),l=$("#booingSaigonRiver #ticketOnewayInfo #note").val(),g=$("#booingSaigonRiver #ticketOnewayInfo #startDate").val();if(""===e[0])return $.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Chưa nhập họ tên chuyến đi"}),!1;if(""===t[0])return $.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Chưa nhập số điện thoại chuyến đi"}),!1;for(var s,d="[",h={},u=0;u<p;u++)h.paymentTicketPrice=v[u],h.phoneNumber=t[u],h.originalPrice=v[u],h.seatId="",h.priceInsurance=0,h.extraPrice=0,h.ticketPrice=v[u],h.isAdult=!0,h.fullName=e[u],h.surcharge=0,h.priceMeal=-1,h.agencyPrice=v[u],h.totalPrice=v[u],d+=u===p-1?JSON.stringify(h):JSON.stringify(h)+",";d+="]",dataListOption={startDate:g,scheduleId:i,paymentTicketPrice:y,packageName:"web",tripId:n,timeZone:"7",originalTicketPrice:y,numberOfAdults:p,getOffPointId:a,phoneNumber:t[0],numberOfChildren:"0",description:l,getOffTimePlan:r,listOption:JSON.parse(d),getInTimePlan:c,fullName:e[0],paidMoney:"0",companyId:systemId,getInPointId:o,agencyPrice:y},s=dataListOption,$.ajax({type:"POST",url:"https://anvui.vn/createnoseatid",data:s,success:function(e){var t,i;200===e.code?($.dialog({title:"Thông báo!",content:"Hệ thống đang chuyển sang cổng thanh toán, vui lòng đợi trong giây lát...",onClose:function(e){e.preventDefault()}}),t=e.results.ticketId,i=s.phoneNumber,$.ajax({type:"POST",url:"https://dobody-anvui.appspot.com/ePay/",dataType:"json",data:JSON.stringify({ticketId:t,paymentType:1,packageName:"web",phoneNumber:i}),success:function(e){url=e.results.redirect,setTimeout(function(){window.location.href=url},6e3)}})):$.alert({title:"Thông báo!",type:"red",typeAnimated:!0,content:"Đã có lỗi xảy ra, vui lòng thử lại"})}})}),$("body").on("click","#booingSaigonRiver .schedule-item",function(){var e=$(this).data("getinpoint"),t=$(this).data("getoffpoint"),i=$(this).data("getintime"),n=$(this).data("getofftime"),o=$(this).data("starttime"),a=$(this).data("tripstatus"),c=$(this).data("scheduleid"),r=$(this).data("ticketprice"),l=$(this).data("tripid"),g=$(this).data("numberticket"),s=$(this).data("startdate");o<Date.now()||2===a?$.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Vé đã bán hết, vui lòng chọn chuyến khác hoặc chọn một ngày khởi hành khác"}):g<p?$.alert({title:"Thông báo!",type:"orange",typeAnimated:!0,content:"Số vé bán đặt nhiều hơn số vé hiện có"}):($("#booingSaigonRiver .schedule-item").removeClass("selected-schedule"),$(this).addClass("selected-schedule"),ticketHtml="",ticketHtml=buildTicket(p,r,l,c,e,t,i,n,s,!1,!1),$("#booingSaigonRiver .ticket-info-list").html(ticketHtml))})});